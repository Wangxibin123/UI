好的，感谢您提供的详细反馈和参考图片！这对于我们精确设计接下来的功能非常有帮助。

根据您的最新指示，我们对**三种模式的定义**、**UI布局**以及**模型列表**进行调整。

**核心思路调整：**

1.  **三种模式的新定义与命名：**
    *   **模式一：LaTeX 格式化 (Latex Formatting)**
        *   **目标**：专注于将输入内容（可能是数学公式、代码、文本）快速转换为规范的 LaTeX 格式。
        *   **图标建议**：可以使用类似 `{ }` 或一个代表公式的图标 (sigma Σ, integral ∫, etc.)。
    *   **模式二：解析分析 (Analysis & Parsing)** - *默认模式*
        *   **目标**：对输入内容进行深入分析、解释、提供步骤、代码理解、上下文关联等。这是之前“聊天/问答”模式的扩展和聚焦。
        *   **图标建议**：可以使用类似大脑、放大镜、或者流程图相关的图标。
    *   **模式三：总结归纳 (Summarization)**
        *   **目标**：对较长的文本、代码段或对话进行概括和提炼，生成简洁的摘要。
        *   **图标建议**：可以使用类似文档堆叠然后变成一个文档、或者一个带有向下箭头的段落图标。

2.  **UI 布局调整关键点：**
    *   **主模式切换 (参考图四，左侧 AI Copilot 下拉位置)**：这里将作为主要的模式切换入口。
        *   将显示当前模式的名称 (例如 "解析分析")，旁边带一个下拉箭头。
        *   点击后展开下拉菜单，列出三种模式供选择（例如：LaTeX 格式化, 解析分析, 总结归纳）。
    *   **快捷模式切换 (参考图五，右侧面板顶部)**：
        *   在右侧面板（当前显示 “LaTeX 格式化”、“解析分析”、“总结归纳” 三个可展开框的位置）的顶部，增加三个**图标按钮**，分别对应这三种模式。
        *   这些按钮提供一种快速切换到特定模式的方式，并且点击后，下方的输入区域（即 AI Copilot 的输入框）会切换到对应模式，同时主模式切换区域的显示也会同步更新。
    *   **右侧面板重新设计 (参考图五)**：
        *   当前的三个可展开框（“LaTeX 格式化”、“解析分析”、“总结归纳”）需要重新设计。
        *   目标是让它们更美观、均衡分布，并占据整个最右侧栏的高度。
        *   每个框不仅是模式的展示，更应该是一个**功能入口/仪表盘**。点击框本身，应该能激活对应的模式，并可能在框内显示与该模式相关的特定信息或快捷操作（这部分可以后续迭代）。
        *   每个框上面应该有清晰的文字说明（模式名称）和对应的图标。
    *   **模型选择 (参考图三，Cursor 模型选择界面)**：
        *   模型选择按钮将位于**底部操作栏的左侧**，模仿 Cursor 的设计，显示当前选定的模型名称（例如 "deepseek-prover-v2"）。
        *   点击后展开一个类似图三的下拉列表，包含您指定的10个模型。
        *   列表项中，模型名称后可以考虑是否需要显示额外信息（如 "MAX", ":thinking"）。
    *   **底部操作栏布局 (参考图一，Cursor 输入栏)**：
        *   **左侧**：模型选择按钮。
        *   **右侧**：附件图标（例如 `Paperclip`）应紧邻发送按钮的**左侧**。发送按钮在最右边。
        *   中间区域可以留空或未来用于其他控制。整体间距需要调整，使其更疏朗。

3.  **模型列表：**
    *   openai/o3
    *   openai/gpt-4.5-preview
    *   google/gemini-2.5-flash-preview:thinking
    *   deepseek/deepseek-prover-v2 (671 B) - *默认模型*
    *   deepseek/deepseek-chat-v3-0324
    *   deepseek/deepseek-r1
    *   qwen/qwen3-30b-a3b
    *   qwen/qwen3-235b-a22b
    *   anthropic/claude-3.7-sonnet
    *   anthropic/claude-3.7-sonnet:thinking

**详细设计与部署计划 (阶段三及后续)：**

**阶段三：核心模式切换、模型选择与初步的模式差异化**

**任务 3.1 (重构)：主模式切换 UI 与状态管理 (AI Copilot 面板内)**

*   **目标**：在 `AICopilotPanel.tsx` 的顶部（或您指定的主切换区域）实现新的模式切换下拉菜单。
*   **详细步骤**：
    1.  **状态定义 (`AICopilotPanel.tsx`)**:
        *   `currentMode`: `'latex' | 'analysis' | 'summary'`，默认 `'analysis'`。
        *   `showModeDropdown`: boolean，控制主模式下拉菜单的显示。
    2.  **主模式切换 UI (`AICopilotPanel.tsx`)**:
        *   移除之前计划的顶部标签按钮。
        *   在面板标题区域（例如 "AI Copilot" 文字旁边）或其下方，实现一个新的模式显示和下拉切换按钮。
            *   显示当前模式名称和下拉箭头。
            *   点击箭头展开下拉列表，列出三种新模式。
            *   选中后更新 `currentMode` 并关闭下拉。
        *   **JSX 示例** (概念性，具体位置需结合您现有 `MainLayout.tsx` 等结构确定):
            ```jsx
            // 假设在 AICopilotPanel 的 panelHeader 内部
            <div className={styles.mainModeSelectorWrapper}>
              <button onClick={() => setShowModeDropdown(!showModeDropdown)} className={styles.mainModeButton}>
                <span className={styles.currentModeText}>{getModeDisplayName(currentMode)}</span>
                <ChevronDown size={16} className={showModeDropdown ? styles.chevronUp : ''} />
              </button>
              {showModeDropdown && (
                <ul className={styles.mainModeDropdownList}>
                  <li onClick={() => { setCurrentMode('latex'); setShowModeDropdown(false); }}>LaTeX 格式化</li>
                  <li onClick={() => { setCurrentMode('analysis'); setShowModeDropdown(false); }}>解析分析</li>
                  <li onClick={() => { setCurrentMode('summary'); setShowModeDropdown(false); }}>总结归纳</li>
                </ul>
              )}
            </div>
            ```
    3.  **CSS (`AICopilotPanel.module.css`)**: 为 `mainModeSelectorWrapper`, `mainModeButton`, `currentModeText`, `mainModeDropdownList` 添加样式。
    4.  **textarea placeholder 动态更新**: 根据 `currentMode` 改变 `textarea` 的占位符。
        *   Latex: "输入内容以格式化为 LaTeX..."
        *   Analysis: "输入问题或代码进行解析分析..." (默认)
        *   Summary: "粘贴文本或描述内容以获取摘要..."
    5.  **`console.log` 清理**：移除 `AICopilotPanel.tsx` 中不再需要的 `console.log` 语句。

**任务 3.2 (重构)：模型选择 UI 与状态管理 (AI Copilot 面板内)**

*   **目标**：实现新的模型选择下拉菜单，使用您提供的模型列表，并使其外观接近 Cursor。
*   **详细步骤**：
    1.  **状态定义 (`AICopilotPanel.tsx`)**:
        *   `availableModels`: 存储您提供的10个模型ID的数组。
        *   `selectedModel`: string，默认 `'deepseek/deepseek-prover-v2 (671 B)'`。
        *   `showModelDropdown`: boolean (复用或创建新的，如果之前的还没实现)。
    2.  **模型选择 UI (`AICopilotPanel.tsx` - 底部操作栏)**:
        *   调整底部操作栏左侧的按钮，使其显示当前模型名称，并能点击展开列表。
        *   列表项的显示需要注意 `(671 B)` 和 `:thinking` 这类后缀。
        *   **JSX 示例 (底部操作栏 `.actionBarLeft`):**
            ```jsx
            <div className={styles.modelSelectorWrapper}>
              <button /* ... onClick, title ... */ className={`${styles.actionButton} ${styles.modelDropdownButton}`}>
                <span className={styles.selectedModelPrefixIcon}> {/* 可选：类似大脑的图标 */} </span>
                <span className={styles.selectedModelName}>{formatModelName(selectedModel)}</span> {/* formatModelName 去除长串路径，保留核心名称和后缀 */}
                <ChevronDown size={14} /* ... */ />
              </button>
              {showModelDropdown && (
                <ul className={styles.modelDropdownList}>
                  {availableModels.map(modelId => (
                    <li key={modelId} /* ... onClick, className ... */ >
                      {formatModelListItem(modelId)} {/* 处理显示，例如高亮 :thinking */}
                      {selectedModel === modelId && <Check size={14} className={styles.selectedModelCheckmark} />}
                    </li>
                  ))}
                </ul>
              )}
            </div>
            ```
    3.  **辅助函数 (`AICopilotPanel.tsx` 或工具函数)**:
        *   `formatModelName(modelId: string)`: 从完整 ID 中提取更易读的显示名称（例如，"gemini-2.5-flash-preview:thinking" -> "Gemini Flash:thinking"）。
        *   `formatModelListItem(modelId: string)`: 格式化下拉列表中的模型名称，可能需要特殊处理 `:thinking` 等后缀的显示。
    4.  **CSS (`AICopilotPanel.module.css`)**:
        *   更新 `modelSelectorWrapper`, `modelDropdownButton`, `selectedModelName`, `modelDropdownList`, `li` 的样式，使其更接近 Cursor 的外观（例如，更宽的下拉列表，列表项内右侧的勾选标记）。增加间距。
    5.  **点击外部关闭**: 确保有逻辑在点击外部时关闭模型下拉列表。

**任务 3.3：底部操作栏布局调整 (AI Copilot 面板内)**

*   **目标**：调整附件图标位置，优化整体间距。
*   **详细步骤**：
    1.  **JSX (`AICopilotPanel.tsx` - 底部操作栏)**:
        *   将附件按钮 (`<Paperclip />`) 移到发送按钮的左边。
        *   移除之前占位的 "Feature 1" (`<Wand2 />`) 按钮，或根据您的意愿保留/修改。
    2.  **CSS (`AICopilotPanel.module.css`)**:
        *   调整 `.bottomActionBar`, `.actionBarLeft`, `.actionBarRight` 的 `gap` 或 `margin`，使元素间距更大，更符合 Cursor 的宽松感。
        *   确保附件按钮和发送按钮在右侧正确对齐和间隔。

**阶段四：右侧面板改造与模式联动**

**任务 4.1：右侧面板顶部快捷模式切换按钮 (影响 `MainLayout.tsx` 或其子组件)**

*   **目标**：在图五所示的右侧区域顶部添加三个图标按钮，用于快速切换 AI Copilot 的模式。
*   **详细步骤**：
    1.  **组件通信**: 需要一种机制，当这些快捷按钮被点击时，能够通知 `AICopilotPanel` 组件更新其 `currentMode` 状态。这可能通过 props 回调、Context API 或状态管理库（如 Zustand, Redux）实现。假设通过 props 回调。
    2.  **UI 实现 (在 `MainLayout.tsx` 或右侧面板的父组件中)**:
        *   添加三个图标按钮，每个按钮代表一种模式。
        *   点击按钮时，调用传递给 `AICopilotPanel` 的回调函数，以更新其模式。
        *   同时，这些按钮自身也需要根据 `AICopilotPanel` 的当前模式来高亮显示活动状态。
    3.  **图标选择**: 为 LaTeX, Analysis, Summary 选择合适的 `lucide-react` 图标。

**任务 4.2：右侧面板内容区域重构 (影响 `MainLayout.tsx` 或其子组件)**

*   **目标**：将图五中原有的三个可展开框替换为新的、更美观、占据整个高度且可点击切换模式的功能区域。
*   **详细步骤**：
    1.  **布局**: 使用 Flexbox或 Grid，让三个新的“模式功能框”垂直均分右侧面板的可用高度。
    2.  **样式**: 每个框应有清晰的边界、背景色、模式图标和模式名称。
    3.  **交互**:
        *   点击任一模式功能框，应触发与顶部快捷图标按钮相同的逻辑：更新 `AICopilotPanel` 的 `currentMode`，并同步快捷图标按钮的高亮状态。
        *   **初期**: 框内可以暂时只显示模式名称和描述。
        *   **后续迭代**: 框内可以根据激活的模式显示不同的内容，例如：
            *   **LaTeX 模式框**: 显示最近格式化的历史片段，或常用 LaTeX 片段。
            *   **解析分析模式框**: 显示分析过程中的关键步骤提示，或相关上下文节点。
            *   **总结归纳模式框**: 显示摘要的配置选项（如长度、风格）。
    4.  **组件结构**: 可能需要为每个模式功能框创建一个新的子组件。

**阶段五：模式特定行为深化与后端集成**

*   **任务 5.1**: 不同模式下，`AICopilotPanel` 输入区域的行为差异化。
    *   例如，LaTeX 模式下，`@提及` 可能被禁用或有不同行为。
    *   Search 模式下，输入框可能会提示特定的搜索语法。
*   **任务 5.2**: `handleSubmit` 函数根据 `currentMode` 和 `selectedModel` 构建不同的请求体，并调用不同的后端 API 端点。
*   **任务 5.3**: 后端 API 的设计与实现，以支持三种模式和不同的模型调用。

**后续计划的确认：**

请您仔细审阅以上调整后的设计思路和分阶段计划，特别是：

1.  **新的三种模式定义（LaTeX 格式化、解析分析、总结归纳）是否准确？图标建议方向是否合适？**
2.  **UI 布局调整，特别是主模式切换（AI Copilot 标题区域下拉）、快捷模式切换（右侧面板顶部图标）、右侧面板重构、模型选择外观、底部操作栏布局，是否符合您的设想？**
3.  **默认模式为“解析分析”，默认模型为“deepseek/deepseek-prover-v2 (671 B)”是否正确？**
4.  **模型列表是否完整准确？对于模型名称在UI上的显示格式（例如，是否缩短路径，如何展示后缀）有无偏好？**
5.  **对于分阶段计划（阶段三、四、五）的优先级和内容是否有异议？**

**我将等待您的确认，尤其是对以上五点的反馈。在您确认后，我将从阶段三的第一个任务（任务 3.1 重构：主模式切换 UI 与状态管理）开始逐步部署。** 我会非常小心，确保每一步都清晰且符合您的要求，不会随意修改现有代码。
